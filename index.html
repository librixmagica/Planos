<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio Parallax Canvas</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #spaceCanvas {
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <canvas id="spaceCanvas" width="500" height="500"></canvas>

    <script>
        const canvas = document.getElementById('spaceCanvas');
        const ctx = canvas.getContext('2d');
        
        // Posiciones base (centro del canvas)
        const centerX = 250;
        const centerY = 250;
        
        // Offsets para el parallax
        let moonOffsetX = 0;
        let moonOffsetY = 0;
        let earthOffsetX = 0;
        let earthOffsetY = 0;
        
        // Cargar imágenes
        const backgroundImg = new Image();
        const earthImg = new Image();
        const moonImg = new Image();
        
        let imagesLoaded = 0;
        const totalImages = 3;
        
        function onImageLoad() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                draw();
            }
        }
        
        backgroundImg.onload = onImageLoad;
        earthImg.onload = onImageLoad;
        moonImg.onload = onImageLoad;
        
        backgroundImg.src = 'background.png';
        earthImg.src = 'earth.png';
        moonImg.src = 'moon.png';
        
        function draw() {
            // Limpiar canvas
            ctx.clearRect(0, 0, 500, 500);
            
            // Dibujar fondo
            ctx.drawImage(backgroundImg, 0, 0, 500, 500);
            
            // Dibujar Tierra (240x240, centrada + offset)
            const earthX = centerX - 120 + earthOffsetX;
            const earthY = centerY - 120 + earthOffsetY;
            ctx.drawImage(earthImg, earthX, earthY, 240, 240);
            
            // Dibujar Luna (120x120, centrada + offset)
            const moonX = centerX - 60 + moonOffsetX;
            const moonY = centerY - 60 + moonOffsetY;
            ctx.drawImage(moonImg, moonX, moonY, 120, 120);
        }
        
        // Para dispositivos móviles - orientación
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', deviceOrientationHandler, false);
        }
        
        // Para escritorio - movimiento del mouse
        canvas.addEventListener('mousemove', function(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const deltaX = (mouseX - centerX) / 10;
            const deltaY = (mouseY - centerY) / 10;
            
            moonOffsetX = deltaX / 4;
            moonOffsetY = deltaY / 4;
            earthOffsetX = deltaX / 6;
            earthOffsetY = deltaY / 6;
            
            draw();
        });
        
        function deviceOrientationHandler(e) {
            const gamma = e.gamma || 0; // Inclinación izq/der
            const beta = e.beta || 0;   // Inclinación adelante/atrás
            
            moonOffsetX = gamma / 4;
            moonOffsetY = beta / 4;
            earthOffsetX = gamma / 6;
            earthOffsetY = beta / 6;
            
            draw();
            
            console.log('Alpha: ' + e.alpha + ', Beta: ' + e.beta + ', Gamma: ' + e.gamma);
        }
        
        // Solicitar permisos en iOS 13+
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            canvas.addEventListener('click', function() {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') {
                            window.addEventListener('deviceorientation', deviceOrientationHandler, false);
                        }
                    })
                    .catch(console.error);
            }, { once: true });
        }
    </script>
</body>
</html>
