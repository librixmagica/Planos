<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio Parallax Canvas</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #spaceCanvas {
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <canvas id="spaceCanvas" width="500" height="500"></canvas>

    <script>
        const canvas = document.getElementById('spaceCanvas');
        const ctx = canvas.getContext('2d');
        
        // Posiciones base (centro del canvas)
        const centerX = 250;
        const centerY = 250;
        
        // Offsets para el parallax
        let moonOffsetX = 0;
        let moonOffsetY = 0;
        let earthOffsetX = 0;
        let earthOffsetY = 0;
        
        // Cargar imágenes
        const backgroundImg = new Image();
        const earthImg = new Image();
        const moonImg = new Image();
        
        let imagesLoaded = 0;
        const totalImages = 3;
        
        function onImageLoad(imageName) {
            imagesLoaded++;
            console.log(`Imagen cargada: ${imageName} (${imagesLoaded}/${totalImages})`);
            if (imagesLoaded === totalImages) {
                console.log('Todas las imágenes cargadas, iniciando dibujo');
                draw();
            }
        }
        
        function onImageError(imageName) {
            console.error(`Error cargando imagen: ${imageName}`);
            // Dibujar un placeholder
            drawPlaceholder();
        }
        
        function drawPlaceholder() {
            // Dibujar fondo negro
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, 500, 500);
            
            // Dibujar círculo para la Tierra
            ctx.fillStyle = 'blue';
            ctx.beginPath();
            ctx.arc(centerX + earthOffsetX, centerY + earthOffsetY, 120, 0, 2 * Math.PI);
            ctx.fill();
            
            // Dibujar círculo para la Luna
            ctx.fillStyle = 'gray';
            ctx.beginPath();
            ctx.arc(centerX + moonOffsetX, centerY + moonOffsetY, 60, 0, 2 * Math.PI);
            ctx.fill();
            
            // Texto de ayuda
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Imágenes no encontradas', centerX, 50);
            ctx.fillText('Usando placeholders', centerX, 70);
        }
        
        backgroundImg.onload = () => onImageLoad('background.png');
        backgroundImg.onerror = () => onImageError('background.png');
        
        earthImg.onload = () => onImageLoad('earth.png');
        earthImg.onerror = () => onImageError('earth.png');
        
        moonImg.onload = () => onImageLoad('moon.png');
        moonImg.onerror = () => onImageError('moon.png');
        
        backgroundImg.src = 'background.jpeg';
        earthImg.src = 'earth.png';
        moonImg.src = 'moon.png';
        
        // Dibujar placeholder inicial
        setTimeout(() => {
            if (imagesLoaded === 0) {
                console.log('No se cargaron imágenes, mostrando placeholder');
                drawPlaceholder();
            }
        }, 1000);
        
        function draw() {
            // Limpiar canvas
            ctx.clearRect(0, 0, 500, 500);
            
            try {
                // Dibujar fondo
                if (backgroundImg.complete && backgroundImg.naturalHeight !== 0) {
                    ctx.drawImage(backgroundImg, 0, 0, 500, 500);
                } else {
                    ctx.fillStyle = 'black';
                    ctx.fillRect(0, 0, 500, 500);
                }
                
                // Dibujar Tierra (240x240, centrada + offset)
                const earthX = centerX - 120 + earthOffsetX;
                const earthY = centerY - 120 + earthOffsetY;
                if (earthImg.complete && earthImg.naturalHeight !== 0) {
                    ctx.drawImage(earthImg, earthX, earthY, 240, 240);
                } else {
                    ctx.fillStyle = 'blue';
                    ctx.beginPath();
                    ctx.arc(centerX + earthOffsetX, centerY + earthOffsetY, 120, 0, 2 * Math.PI);
                    ctx.fill();
                }
                
                // Dibujar Luna (120x120, centrada + offset)
                const moonX = centerX - 60 + moonOffsetX;
                const moonY = centerY - 60 + moonOffsetY;
                if (moonImg.complete && moonImg.naturalHeight !== 0) {
                    ctx.drawImage(moonImg, moonX, moonY, 120, 120);
                } else {
                    ctx.fillStyle = 'gray';
                    ctx.beginPath();
                    ctx.arc(centerX + moonOffsetX, centerY + moonOffsetY, 60, 0, 2 * Math.PI);
                    ctx.fill();
                }
            } catch (error) {
                console.error('Error al dibujar:', error);
                drawPlaceholder();
            }
        }
        
        // Variables de control
        let isUsingDeviceOrientation = false;
        
        // Para dispositivos móviles - orientación
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', deviceOrientationHandler, false);
        }
        /*
        // Para escritorio - movimiento del mouse (solo si no hay orientación)
        canvas.addEventListener('mousemove', function(e) {
            if (!isUsingDeviceOrientation) {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                const deltaX = (mouseX - centerX) / 10;
                const deltaY = (mouseY - centerY) / 10;
                
                moonOffsetX = deltaX / 4;
                moonOffsetY = deltaY / 4;
                earthOffsetX = deltaX / 6;
                earthOffsetY = deltaY / 6;
                
                draw();
            }
        });*/
        
        function deviceOrientationHandler(e) {
            isUsingDeviceOrientation = true;
            
            const gamma = e.gamma || 0; // Inclinación izq/der
            const beta = e.beta || 0;   // Inclinación adelante/atrás
            
            moonOffsetX = gamma / 2;
            moonOffsetY = beta / 2;
            earthOffsetX = gamma / 6;
            earthOffsetY = beta / 6;
            
            draw();
            
            console.log('Usando orientación - Alpha: ' + e.alpha + ', Beta: ' + e.beta + ', Gamma: ' + e.gamma);
        }
        
        // Solicitar permisos en iOS 13+
        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            canvas.addEventListener('click', function() {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') {
                            console.log('Permisos de orientación concedidos');
                            window.addEventListener('deviceorientation', deviceOrientationHandler, false);
                        }
                    })
                    .catch(console.error);
            }, { once: true });
        }
        
        // Forzar un dibujo inicial aunque no haya imágenes
        setTimeout(() => {
            console.log('Forzando dibujo inicial...');
            draw();
        }, 100);
    </script>
</body>
</html>
